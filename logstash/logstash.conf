input {
  file {
    type => "rest-server"
    path => "/var/log/containers/rest-server*.log"
  }
  #stdin {
  #  type => "stdin"
  #}
  #file {
  #  type => "syslog"
  #  path => "/var/log/syslog"
  #}
  #syslog {
  #  type => "syslog-server"
  #  host => "localhost"
  #  port => 5140
  #}
}

filter {
  json {
    source => "message"
  }
  mutate {
    gsub => [
      "log", "\e\[\d+m", ""
    ]
  }
  grok {
    match => {
      "log" => "%{TIMESTAMP_ISO8601:log_timestamp} \[%{LOGLEVEL:log_level}\] %{WORD:request_method} %{URIPATHPARAM:request_url} %{NUMBER:response_status_code} %{NUMBER:response_time_in_ms} ms"
    }
  }
  mutate {
    convert => {
      "response_status_code" => "integer"
      "response_time_in_ms" => "float"
    }
  }
}

output {
  #stdout {
  #  codec => rubydebug
  #}
  elasticsearch {
    hosts => ["localhost"]
    index => "logstash-%{+YYYY.MM.dd}"
  }
}

